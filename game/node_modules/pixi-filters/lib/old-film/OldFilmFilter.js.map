{"version":3,"file":"OldFilmFilter.js","sources":["../../src/old-film/OldFilmFilter.ts"],"sourcesContent":["import { Filter, GlProgram, GpuProgram } from 'pixi.js';\nimport { vertex, wgslVertex } from '../defaults';\nimport fragment from './old-film.frag';\nimport source from './old-film.wgsl';\n\nimport type { FilterSystem, RenderSurface, Texture } from 'pixi.js';\n\n/** Options for the OldFilmFilter constructor. */\nexport interface OldFilmFilterOptions\n{\n    /**\n     * The amount of saturation of sepia effect,\n     * a value of `1` is more saturation and closer to `0` is less, and a value of `0` produces no sepia effect\n     * @default 0.3\n     */\n    sepia?: number;\n    /**\n     * Opacity/intensity of the noise effect between `0` and `1`\n     * @default 0.3\n     */\n    noise?: number;\n    /**\n     * The size of the noise particles\n     * @default 1\n     */\n    noiseSize?: number;\n    /**\n     * How often scratches appear\n     * @default 0.5\n     */\n    scratch?: number;\n    /**\n     * The density of the number of scratches\n     * @default 0.3\n     */\n    scratchDensity?: number;\n    /**\n     * The width of the scratches\n     * @default 1\n     */\n    scratchWidth?: number;\n    /**\n     * The radius of the vignette effect, smaller values produces a smaller vignette\n     * @default 0.3\n     */\n    vignetting?: number;\n    /**\n     * Amount of opacity on the vignette\n     * @default 1\n     */\n    vignettingAlpha?: number;\n    /**\n     * Blur intensity of the vignette\n     * @default 1\n     */\n    vignettingBlur?: number;\n    /**\n     * A seed value to apply to the random noise generation\n     * @default 0\n     */\n    seed?: number;\n}\n\n/**\n * The OldFilmFilter applies a Old film effect to an object.<br>\n * ![original](../screenshots/original.png)![filter](../screenshots/old-film.gif)\n *\n * @class\n * @extends Filter\n */\nexport class OldFilmFilter extends Filter\n{\n    /** Default values for options. */\n    public static readonly DEFAULT_OPTIONS: OldFilmFilterOptions = {\n        sepia: 0.3,\n        noise: 0.3,\n        noiseSize: 1,\n        scratch: 0.5,\n        scratchDensity: 0.3,\n        scratchWidth: 1,\n        vignetting: 0.3,\n        vignettingAlpha: 1,\n        vignettingBlur: 0.3,\n        seed: 0\n    };\n\n    public uniforms: {\n        uSepia: number;\n        uNoise: Float32Array;\n        uScratch: Float32Array;\n        uVignetting: Float32Array;\n        uSeed: number;\n        uDimensions: Float32Array;\n    };\n\n    /**\n     * A seed value to apply to the random noise generation\n     * @default 0\n     */\n    public seed!: number;\n\n    /**\n     * @param options - Options for the OldFilmFilter constructor.\n     */\n    constructor(options?: OldFilmFilterOptions)\n    {\n        options = { ...OldFilmFilter.DEFAULT_OPTIONS, ...options };\n\n        const gpuProgram = GpuProgram.from({\n            vertex: {\n                source: wgslVertex,\n                entryPoint: 'mainVertex',\n            },\n            fragment: {\n                source,\n                entryPoint: 'mainFragment',\n            },\n        });\n\n        const glProgram = GlProgram.from({\n            vertex,\n            fragment,\n            name: 'old-film-filter',\n        });\n\n        super({\n            gpuProgram,\n            glProgram,\n            resources: {\n                oldFilmUniforms: {\n                    uSepia: { value: options.sepia, type: 'f32' },\n                    uNoise: { value: new Float32Array(2), type: 'vec2<f32>' },\n                    uScratch: { value: new Float32Array(3), type: 'vec3<f32>' },\n                    uVignetting: { value: new Float32Array(3), type: 'vec3<f32>' },\n                    uSeed: { value: options.seed, type: 'f32' },\n                    uDimensions: { value: new Float32Array(2), type: 'vec2<f32>' },\n                }\n            },\n        });\n\n        this.uniforms = this.resources.oldFilmUniforms.uniforms;\n\n        Object.assign(this, options);\n    }\n\n    /**\n     * Override existing apply method in `Filter`\n     * @override\n     * @ignore\n     */\n    public override apply(\n        filterManager: FilterSystem,\n        input: Texture,\n        output: RenderSurface,\n        clearMode: boolean\n    ): void\n    {\n        this.uniforms.uDimensions[0] = input.frame.width;\n        this.uniforms.uDimensions[1] = input.frame.height;\n        this.uniforms.uSeed = this.seed;\n\n        filterManager.applyFilter(this, input, output, clearMode);\n    }\n\n    /**\n     * The amount of saturation of sepia effect,\n     * a value of `1` is more saturation and closer to `0` is less, and a value of `0` produces no sepia effect\n     * @default 0.3\n     */\n    get sepia(): number { return this.uniforms.uSepia; }\n    set sepia(value: number) { this.uniforms.uSepia = value; }\n\n    /**\n     * Opacity/intensity of the noise effect between `0` and `1`\n     * @default 0.3\n     */\n    get noise(): number { return this.uniforms.uNoise[0]; }\n    set noise(value: number) { this.uniforms.uNoise[0] = value; }\n\n    /**\n     * The size of the noise particles\n     * @default 1\n     */\n    get noiseSize(): number { return this.uniforms.uNoise[1]; }\n    set noiseSize(value: number) { this.uniforms.uNoise[1] = value; }\n\n    /**\n     * How often scratches appear\n     * @default 0.5\n     */\n    get scratch(): number { return this.uniforms.uScratch[0]; }\n    set scratch(value: number) { this.uniforms.uScratch[0] = value; }\n\n    /**\n     * The density of the number of scratches\n     * @default 0.3\n     */\n    get scratchDensity(): number { return this.uniforms.uScratch[1]; }\n    set scratchDensity(value: number) { this.uniforms.uScratch[1] = value; }\n\n    /**\n     * The width of the scratches\n     * @default 1\n     */\n    get scratchWidth(): number { return this.uniforms.uScratch[2]; }\n    set scratchWidth(value: number) { this.uniforms.uScratch[2] = value; }\n\n    /**\n     * The radius of the vignette effect, smaller values produces a smaller vignette\n     * @default 0.3\n     */\n    get vignetting(): number { return this.uniforms.uVignetting[0]; }\n    set vignetting(value: number) { this.uniforms.uVignetting[0] = value; }\n\n    /**\n     * Amount of opacity on the vignette\n     * @default 1\n     */\n    get vignettingAlpha(): number { return this.uniforms.uVignetting[1]; }\n    set vignettingAlpha(value: number) { this.uniforms.uVignetting[1] = value; }\n\n    /**\n     * Blur intensity of the vignette\n     * @default 1\n     */\n    get vignettingBlur(): number { return this.uniforms.uVignetting[2]; }\n    set vignettingBlur(value: number) { this.uniforms.uVignetting[2] = value; }\n}\n"],"names":["Filter","GpuProgram","wgslVertex","source","GlProgram","vertex","fragment"],"mappings":"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"}